# Iterio 手動テスト手順書

このドキュメントでは、Iterioアプリの主要な機能を手動でテストするための手順を記載します。
リリース前に実施すべき手動テストシナリオをまとめています。

---

## 目次

1. [トライアルフロー](#1-トライアルフロー)
2. [課金フロー](#2-課金フロー)
3. [フォーカスモードフロー](#3-フォーカスモードフロー)
4. [バックアップフロー](#4-バックアップフロー)
5. [タイマー機能](#5-タイマー機能)
6. [設定機能](#6-設定機能)
7. [統計・復習機能](#7-統計復習機能)

---

## 1. トライアルフロー

### 1.1 新規インストール時のトライアル開始

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | アプリを新規インストール | アプリが正常に起動する |
| 2 | ホーム画面を確認 | Premium機能がロックされている |
| 3 | 設定画面 → Premium へ移動 | 「7日間無料トライアル」ボタンが表示される |
| 4 | トライアル開始ボタンをタップ | トライアルが開始され、Premium機能が解放される |
| 5 | 設定画面のPremiumセクションを確認 | 「トライアル中: X日残り」と表示される |

**前提条件:**
- アプリをアンインストールし、データを完全に削除
- 新規インストール後の初回起動

**期待結果チェックリスト:**
- [ ] トライアル開始の確認ダイアログが表示される
- [ ] トライアル期間（7日間）が正しく表示される
- [ ] 開始後、すべてのPremium機能にアクセス可能になる
- [ ] 設定画面にトライアル残り日数が表示される

### 1.2 トライアル期間中の通知

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | トライアル開始から6日経過 | 期限切れ警告通知が表示される |
| 2 | 通知をタップ | Premium画面に遷移する |

**期待結果チェックリスト:**
- [ ] トライアル期限が近づくと通知が表示される（残り3日、1日）
- [ ] 通知をタップするとPremium画面に遷移する

### 1.3 トライアル期限切れ後の挙動

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | トライアル開始から7日経過 | トライアルが期限切れになる |
| 2 | Premium機能（BGM、完全ロックモードなど）を使用 | 機能がロックされ、アップセルダイアログが表示される |
| 3 | 設定画面のPremiumセクションを確認 | アップグレードカードが表示される |
| 4 | Premium画面へ移動 | 「7日間無料トライアル」ボタンが**非表示**になっている |

**期待結果チェックリスト:**
- [ ] トライアル期限切れのメッセージが表示される
- [ ] Premium機能へのアクセスがブロックされる
- [ ] 購入画面への誘導が表示される
- [ ] 基本機能（タイマー、タスク管理）は引き続き利用可能

---

## 2. 課金フロー

### 2.1 購入テスト（テストカード使用）

> **前提条件**: Google Play Consoleでテスト用アカウントを設定していること

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | Premium画面へ移動 | プラン一覧が表示される |
| 2 | 月額プランを選択 | プランカードがハイライトされる |
| 3 | 「購入する」ボタンをタップ | Google Play購入画面が表示される |
| 4 | テストカードで購入を完了 | 購入完了スナックバーが表示される |
| 5 | Premium機能を確認 | 全てのPremium機能が解放される |

### 2.2 各プランの購入テスト

| プラン | 商品ID | 価格表示 | 割引表示 | 月額換算表示 |
|-------|--------|---------|---------|------------|
| 月額プラン | iterio_premium_monthly | ¥480/月 | - | - |
| 3ヶ月プラン | iterio_premium_quarterly | ¥1,200/3ヶ月 | 17%お得 | ¥400/月 |
| 6ヶ月プラン | iterio_premium_half_yearly | ¥2,000/6ヶ月 | 31%お得 | ¥333/月 |
| 年額プラン | iterio_premium_yearly | ¥3,000/年 | おすすめ・48%お得 | ¥250/月 |
| 買い切り | iterio_premium_lifetime | ¥4,000 | 永久利用 | - |

**期待結果チェックリスト:**
- [ ] 価格がローカライズされて表示される
- [ ] 購入フローがスムーズに進む
- [ ] 購入完了後、即座にPremium状態が反映される
- [ ] 設定画面に購読状態が正しく表示される

### 2.3 購入復元テスト

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | アプリをアンインストール | - |
| 2 | アプリを再インストール | Premium機能がロックされている |
| 3 | Premium画面へ移動 | 購入復元ボタンが表示される |
| 4 | 「購入を復元」をタップ | 購入が復元され、Premium機能が解放される |

### 2.4 購入キャンセルテスト

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 購入フローを開始 | Google Playダイアログが表示される |
| 2 | Google Playダイアログでキャンセル | エラーが発生せず、適切なメッセージが表示される |

**期待結果チェックリスト:**
- [ ] キャンセル時にエラーが発生しない
- [ ] 適切なキャンセルメッセージが表示される
- [ ] 購入前の状態が維持される

### 2.5 解約テスト

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | Google Play → 定期購入 へ移動 | Iterioの定期購入が表示される |
| 2 | 定期購入を解約 | 解約確認ダイアログが表示される |
| 3 | 解約を確定 | 次回更新日まではPremium機能が使用可能 |
| 4 | 更新日を過ぎる | Premium機能がロックされる |

---

## 3. フォーカスモードフロー

### 3.1 フォーカスモード有効化

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 設定画面 → フォーカスモード へ移動 | フォーカスモードセクションが表示される |
| 2 | 「フォーカスモードを有効化」をON | トグルがONになり、追加設定が表示される |
| 3 | タイマー画面へ移動 | - |
| 4 | 開始ボタンをタップ | フォーカスモード開始ダイアログが表示される |

### 3.2 フォーカスモード開始ダイアログの確認

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | フォーカスモード開始ダイアログを確認 | サイクル数選択UIが表示される |
| 2 | サイクル数の「+」ボタンをタップ | サイクル数が増加する |
| 3 | サイクル数の「-」ボタンをタップ | サイクル数が減少する |
| 4 | 完全ロックモードチェックボックスを確認 | Premiumユーザー: チェック可能、非Premium: Premiumバッジ付き |
| 5 | 許可アプリセクションを確認 | 完全ロックモード未選択時に表示される |

### 3.3 完全ロックモード（Premium機能）

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | フォーカスモード開始ダイアログで完全ロックモードをON | チェックが入り、許可アプリセクションが非表示になる |
| 2 | 「開始する」をタップ | タイマーが開始される |
| 3 | 戻るボタンをタップ | 「終了できません」ダイアログが表示される |
| 4 | 停止ボタンを確認 | ロックアイコンが表示され、無効化されている |
| 5 | 「わかりました」をタップ | ダイアログが閉じ、タイマーが継続する |
| 6 | タイマー完了 | ロック解除・完了ダイアログ表示 |

**期待結果チェックリスト:**
- [ ] アプリ切り替えがより厳格にブロックされる
- [ ] ロック解除なしではタイマーをキャンセルできない
- [ ] 緊急アプリ（電話、設定など）は引き続きアクセス可能

### 3.4 通常フォーカスモード（完全ロックなし）

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | フォーカスモード開始ダイアログで完全ロックモードをOFF | - |
| 2 | 「開始する」をタップ | タイマーが開始される |
| 3 | 停止ボタンを確認 | 停止アイコンが表示され、有効化されている |
| 4 | 戻るボタンをタップ | キャンセル確認ダイアログが表示される |

### 3.5 許可アプリ設定

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 設定画面 → フォーカスモード → 許可アプリ | 許可アプリ設定画面が表示される |
| 2 | アプリを検索 | 検索結果が表示される |
| 3 | アプリを選択/解除 | チェック状態が変更される |
| 4 | 一括選択/解除ボタンをテスト | 全てのアプリが選択/解除される |

**期待結果チェックリスト:**
- [ ] インストール済みアプリ一覧が表示される
- [ ] 検索が正しく機能する
- [ ] 選択状態が保存される
- [ ] タイマー開始時に設定が反映される

### 3.6 タイマー完了時のフォーカスモード解除

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | フォーカスモードでタイマーを開始 | - |
| 2 | 全サイクル完了 | 完了ダイアログが表示される |
| 3 | 「終了」をタップ | フォーカスモードが解除される |

---

## 4. バックアップフロー

### 4.1 ローカルエクスポート

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 設定画面 → バックアップ へ移動 | バックアップ画面が表示される |
| 2 | 「エクスポート」をタップ | ファイル保存ダイアログが表示される |
| 3 | 保存場所を選択し、保存 | 暗号化されたバックアップ作成 |
| 4 | 「エクスポート完了」ダイアログを確認 | 成功メッセージが表示される |

**期待結果チェックリスト:**
- [ ] `iterio_backup_YYYYMMDD_HHmmss.json` ファイルが作成される
- [ ] バックアップ完了のメッセージが表示される
- [ ] ファイルサイズが妥当（空でない）
- [ ] ファイルが暗号化されている

### 4.2 ローカルインポート

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 「インポート」をタップ | ファイル選択ダイアログが表示される |
| 2 | バックアップファイルを選択 | データ復元確認ダイアログが表示される |
| 3 | 「上書きする」をタップ | インポート処理が開始される |
| 4 | 処理完了を確認 | インポート結果ダイアログが表示される（件数含む） |

**期待結果チェックリスト:**
- [ ] インポート確認ダイアログが表示される
- [ ] データが正しく復元される（タスク、科目、設定、学習セッション）
- [ ] インポート後も正常に動作する

### 4.3 クラウドバックアップ（Google Drive）

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | Google Driveセクションを確認 | 「Googleアカウントに接続」ボタンが表示される |
| 2 | 「Googleアカウントに接続」をタップ | Googleサインイン画面が表示される |
| 3 | Googleアカウントでサインイン | 接続成功、メールアドレスが表示される |
| 4 | 「保存」ボタンをタップ | クラウドにバックアップがアップロードされる |
| 5 | アップロード完了を確認 | 「アップロード完了」ダイアログが表示される |

### 4.4 クラウドからの復元

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | Googleアカウントに接続済みの状態 | 最終バックアップ日時が表示される |
| 2 | 「復元」ボタンをタップ | 復元確認ダイアログが表示される |
| 3 | 「復元する」をタップ | クラウドからデータが復元される |
| 4 | 復元完了を確認 | 復元結果ダイアログが表示される（件数含む） |

---

## 5. タイマー機能

### 5.1 基本的なタイマー操作

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | タスクを選択してタイマー画面へ移動 | 「準備完了」と表示される |
| 2 | 開始ボタンをタップ | タイマーが開始、「作業中」と表示される |
| 3 | 一時停止ボタンをタップ | タイマーが一時停止、再開ボタンが表示される |
| 4 | 再開ボタンをタップ | タイマーが再開される |
| 5 | 停止ボタンをタップ | キャンセル確認ダイアログが表示される |

### 5.2 フェーズ遷移

| フェーズ | 表示テキスト | 表示色 |
|---------|------------|-------|
| 作業 | 作業中 | Primary (青/緑系) |
| 短休憩 | 休憩中 | Tertiary |
| 長休憩 | 長休憩中 | Tertiary |
| 待機 | 準備完了 | OnSurfaceVariant |

### 5.3 サイクルカウンター

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 1サイクル目の作業を完了 | 「サイクル 1 / X」と表示される |
| 2 | 1サイクル目の休憩を完了 | サイクルインジケーターの1つ目が完了色になる |
| 3 | 全サイクルを完了 | 完了ダイアログが表示される |

### 5.4 バックグラウンド動作

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | タイマーを開始 | - |
| 2 | ホームボタンでバックグラウンドへ | タイマーが継続 |
| 3 | 数分後にアプリに戻る | 正しい残り時間が表示される |

**期待結果チェックリスト:**
- [ ] バックグラウンドでもタイマーが進行する
- [ ] 通知でタイマー状態が確認できる
- [ ] アプリに戻った時に正しい残り時間が表示される

### 5.5 BGM機能（Premium）

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | タイマー画面でBGMボタンをタップ | Premiumユーザー: BGM選択ボトムシート、非Premium: アップセルダイアログ |
| 2 | BGMを選択 | 選択したBGMが表示される |
| 3 | 再生ボタンをタップ | BGMが再生される |
| 4 | 音量スライダーを調整 | BGMの音量が変化する |

---

## 6. 設定機能

### 6.1 通知設定

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 設定画面 → 通知セクション | リマインダー通知トグルが表示される |
| 2 | トグルをON/OFF | 通知設定が変更される |

### 6.2 目標設定

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 設定画面 → 目標セクション | 1日の学習目標スライダーが表示される |
| 2 | スライダーを調整 | 目標時間が15分〜180分の範囲で変更される |

### 6.3 ポモドーロタイマー設定

| 項目 | 範囲 | デフォルト値 |
|-----|------|------------|
| 作業時間 | 1分〜180分 | 25分 |
| 短休憩 | 3分〜15分 | 5分 |
| 長休憩 | 10分〜30分 | 15分 |
| 長休憩までのサイクル数 | 2〜6 | 4 |

### 6.4 自動ループ設定（Premium）

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | 設定画面 → タイマーセクション | 自動ループトグルが表示される |
| 2 | トグルをON（Premiumユーザー） | 自動ループが有効になる |
| 3 | トグルをタップ（非Premiumユーザー） | Premium画面に遷移する |

---

## 7. 統計・復習機能

### 7.1 学習統計の確認

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | いくつかの学習セッションを完了 | - |
| 2 | 統計画面を開く | 統計情報が表示される |

**期待結果チェックリスト:**
- [ ] 今日の学習時間が正しく表示される
- [ ] 週間/月間の統計が正しく集計される
- [ ] 連続学習日数が正しくカウントされる
- [ ] グラフが正しく描画される

### 7.2 復習タスクの生成

| ステップ | 操作 | 期待結果 |
|:-------:|------|---------|
| 1 | タスクの学習セッションを完了 | - |
| 2 | ホーム画面の「今日の復習」セクションを確認 | 復習タスクが生成される |

**期待結果チェックリスト:**
- [ ] 復習タスクが生成される（1日後、3日後など）
- [ ] 復習タスクの日付が正しい
- [ ] Premium/無料で復習間隔の数が異なる

---

## テスト環境

### 推奨デバイス

- Android 8.0 (API 26) 以上
- 画面サイズ: 5.5インチ以上を推奨

### テスト用アカウント

| 用途 | アカウント |
|-----|----------|
| Google Play テスト購入 | テスターアカウントを使用 |
| クラウドバックアップ | 任意のGoogleアカウント |

### 必要な権限

1. **フォーカスモードテスト時**
   - 「他のアプリの上に重ねて表示」権限
   - 「使用状況へのアクセス」権限

2. **通知テスト時**
   - 通知権限（Android 13以降では実行時権限）

---

## テスト完了チェックリスト

| カテゴリ | ステータス | 確認者 | 日付 |
|----------|-----------|--------|------|
| トライアルフロー | [ ] | | |
| 課金フロー | [ ] | | |
| フォーカスモード | [ ] | | |
| バックアップフロー | [ ] | | |
| タイマー機能 | [ ] | | |
| 設定機能 | [ ] | | |
| 統計・復習機能 | [ ] | | |

---

## 検証コマンド

```bash
# UIテスト実行 (エミュレータ/実機必要)
./gradlew connectedAndroidTest

# 特定テストのみ実行
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.iterio.app.ui.TimerScreenTest

# ユニットテスト実行
./gradlew test

# デバッグビルド
./gradlew assembleDebug

# リリースビルド
./gradlew assembleRelease

# lint チェック
./gradlew lint
```

---

## バグ報告テンプレート

```markdown
## 概要
[バグの簡潔な説明]

## 再現手順
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

## 期待される動作
[正常な場合の動作]

## 実際の動作
[発生した問題]

## 環境
- デバイス: [例: Pixel 6]
- Android バージョン: [例: Android 13]
- アプリバージョン: [例: 1.0.0]
- Premium状態: [Free / トライアル中 / 有料会員]

## スクリーンショット/動画
[可能であれば添付]
```

---

## 注意事項

1. **課金テスト前の準備**
   - Google Play Consoleでテスターアカウントを設定
   - `gradle.properties` に `BILLING_PUBLIC_KEY` を設定

2. **フォーカスモードテスト時**
   - 「他のアプリの上に重ねて表示」権限が必要
   - 「使用状況へのアクセス」権限が必要

3. **通知テスト時**
   - 通知権限が許可されていることを確認
   - Android 13以降では実行時権限が必要
